<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Inflow and Outflow from IRN and PAK per Month </title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Load Chart.js from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Load Papa Parse from CDN to parse CSV files -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body {
      font-family: "Gill Sans Nova", "Gill Sans", sans-serif;
      padding: 20px;
      background-color: #f5f5f5;
      text-align: center;
    }
    #chart-container {
      width: 80%;
      max-width: 2000px;
      margin: 0 auto;
    }
  </style>
</head>
<body>
    <!-- Filter Dropdown placed at the top-right -->
    <div id="filter-container">
        <label for="countryFilter">Filter by Country: </label>
        <select id="countryFilter">
            <option value="In">In</option>
            <option value="Out">Out</option>
            <option value="Abdullah">Abdullah</option>
        </select>
    </div>
    <div id="chart-container">
        <canvas id="lineChart"></canvas>
    </div>

    <script>
        function filterAndUpdateChart() {
            const selectedCountry = document.getElementById("countryFilter").value;
            Papa.parse("data.csv", {
                download: true,
                header: true,
                dynamicTyping: true,
                complete: function (results) {
                    // Log the parsed CSV data to the console (for debugging)
                    console.log(results.data);

                    const dates = [];
                    const inflows = [];
                    const outflows = [];
                    const abdullah = [];

                    // Attach event listener to the filter dropdown so that the chart updates on selection


                    // Loop through each row of the CSV
                    results.data.forEach(function (row) {
                        // Check if required fields exist before adding them to the arrays
                        if (row.Date && row.Inflow !== undefined && row.Outflow !== undefined) {
                            dates.push(row.Date);
                            const selectedCountry = document.getElementById("countryFilter").value;
                            if (selectedCountry == "In") { inflows.push(row.Inflow); }
                            if (selectedCountry == "Out") { outflows.push(row.Outflow); }
                            if (selectedCountry == "Abdullah") { abdullah.push(row.Abdullah); }
                        }
                    });

                    // Create the line chart using Chart.js
                    const ctx = document.getElementById('lineChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: dates,
                            datasets: [
                                {
                                    label: 'Inflow',
                                    data: inflows,
                                    fill: false,
                                    borderColor: 'rgba(92, 184, 178, 1)',
                                    backgroundColor: 'rgba(231, 244, 243, 0.2)',
                                    tension: 0.1
                                },
                                {
                                    label: 'Outflow',
                                    data: outflows,
                                    fill: false,
                                    borderColor: 'rgba(0, 51, 160, 1)',
                                    backgroundColor: 'rgba(217, 224, 241, 0.2)',
                                    tension: 0.1
                                },
                                {
                                    label: 'Abdullah',
                                    data: abdullah,
                                    fill: false,
                                    borderColor: 'rgba(0, 51, 160, 1)',
                                    backgroundColor: 'rgba(217, 224, 241, 0.2)',
                                    tension: 0.1
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                x: {
                                    title: {
                                        display: false,
                                        text: 'Date'
                                    }
                                },
                                y: {
                                    title: {
                                        display: false,
                                        text: 'Amount'
                                    }
                                }
                            }
                        }
                    });
                },
                error: function (error) {
                    console.error("Error parsing CSV:", error);
                }
            });
        }

        document.getElementById("countryFilter").addEventListener("change", filterAndUpdateChart);

        // Use Papa Parse to load the CSV file
        Papa.parse("data.csv", {
            download: true,
            header: true,
            dynamicTyping: true,
            complete: function (results) {
                // Log the parsed CSV data to the console (for debugging)
                console.log(results.data);

                const dates = [];
                const inflows = [];
                const outflows = [];
                const abdullah = [];

                // Attach event listener to the filter dropdown so that the chart updates on selection


                // Loop through each row of the CSV
                results.data.forEach(function (row) {
                    // Check if required fields exist before adding them to the arrays
                    if (row.Date && row.Inflow !== undefined && row.Outflow !== undefined) {
                        dates.push(row.Date);
                        const selectedCountry = document.getElementById("countryFilter").value;
                        if (selectedCountry == "In") { inflows.push(row.Inflow); }
                        if (selectedCountry == "Out") { outflows.push(row.Outflow); }
                        if (selectedCountry == "Abdullah") { abdullah.push(row.Abdullah); }
                    }
                });

                // Create the line chart using Chart.js
                const ctx = document.getElementById('lineChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: [
                            {
                                label: 'Inflow',
                                data: inflows,
                                fill: false,
                                borderColor: 'rgba(92, 184, 178, 1)',
                                backgroundColor: 'rgba(231, 244, 243, 0.2)',
                                tension: 0.1
                            },
                            {
                                label: 'Outflow',
                                data: outflows,
                                fill: false,
                                borderColor: 'rgba(0, 51, 160, 1)',
                                backgroundColor: 'rgba(217, 224, 241, 0.2)',
                                tension: 0.1
                            },
                            {
                                label: 'Abdullah',
                                data: abdullah,
                                fill: false,
                                borderColor: 'rgba(0, 51, 160, 1)',
                                backgroundColor: 'rgba(217, 224, 241, 0.2)',
                                tension: 0.1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            x: {
                                title: {
                                    display: false,
                                    text: 'Date'
                                }
                            },
                            y: {
                                title: {
                                    display: false,
                                    text: 'Amount'
                                }
                            }
                        }
                    }
                });
            },
            error: function (error) {
                console.error("Error parsing CSV:", error);
            }
        });
    </script>
</body>
</html>
